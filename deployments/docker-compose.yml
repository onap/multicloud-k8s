# Copyright 2018 Intel Corporation.
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#     http://www.apache.org/licenses/LICENSE-2.0
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

version: '2'

services:
  multicloud-k8s:
    image: ${IMAGE_NAME}
    networks:
      multicloud_net:
        ipv4_address: 172.19.0.3
    build:
      context: ./
      args:
        - HTTP_PROXY=$HTTP_PROXY
        - HTTPS_PROXY=$HTTPS_PROXY
        - NO_PROXY=$NO_PROXY
    ports:
      - "8081:8081"
    environment:
      - CSAR_DIR=/opt/csar
      - KUBE_CONFIG_DIR=/opt/kubeconfig
      - DATABASE_TYPE=mongo
      - DATABASE_IP=172.19.0.2
      - PLUGINS_DIR=/opt/multicloud/k8s
      - HTTP_PROXY=$HTTP_PROXY
      - HTTPS_PROXY=$HTTPS_PROXY
      - NO_PROXY=$NO_PROXY,172.19.0.2
    depends_on:
      - mongo
    links:
      - mongo
    volumes:
      - /opt/csar:/opt/csar
      - /opt/kubeconfig:/opt/kubeconfig
  mongo:
    image: mongo
    networks:
      multicloud_net:
        ipv4_address: 172.19.0.2
    environment:
      HTTP_PROXY: $HTTP_PROXY
      HTTPS_PROXY: $HTTPS_PROXY
      NO_PROXY: $NO_PROXY

networks:
  multicloud_net:
    driver: bridge
    ipam:
      driver: default
      config:
      -
        subnet: 172.19.0.0/27
